{"ast":null,"code":"var _jsxFileName = \"/home/alex/Documents/usp/graduacao/terceiroSemestre/POO/Projeto/Client/charity-donation/src/pages/Login.js\";\nimport React, { Component } from 'react';\nimport ResponseType from '../connection/ResponseType';\nimport Connection from '../connection/Connection';\nimport CryptoJS from 'crypto-js';\nimport { Redirect } from 'react-router-dom';\n/**\n * Componente do React criado utilizando classes para\n * que possa ter acesso a estados. Possui metodos para \n * renderizar e buscar dados no servidor.\n * O componente Login representa uma pagina de login.\n *\n * @class Login\n * @extends {Component}\n */\n\nclass Login extends Component {\n  /**\n   * Cria uma instancia de Login, que é um JSX Component\n   * \n   * @param {*} props propriedades passadas para o objeto\n   * @memberof Login\n   */\n  constructor(props) {\n    super(props);\n    this.state = {\n      errorMessage: ''\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n  }\n  /**\n   * Envia um request de login para o servidor, ou muda o \n   * estado para mostrar um erro, caso user ou senha sejam \n   * invalidos\n   *\n   * @memberof Login\n   */\n\n\n  login() {\n    if (this.socket.readyState !== this.socket.OPEN) setTimeout(this.login, 10);\n    const _this$state = this.state,\n          username = _this$state.username,\n          password = _this$state.password;\n\n    if (username && password) {\n      const hashPass = CryptoJS.MD5(password);\n      const user = {\n        username: username,\n        password: hashPass.toString()\n      };\n      const msg = {\n        type: ResponseType.LOGIN,\n        message: JSON.stringify(user)\n      };\n      this.socket.send(JSON.stringify(msg));\n    } else {\n      this.setState({\n        error: true,\n        errorMessage: 'Insira o nome e a senha'\n      });\n    }\n\n    event.target.reset();\n  }\n  /**\n   * Utilizado para gerenciar as submissoes dos \n   * formularios da pagina, realizando a chamada \n   * de login\n   *\n   * @param {*} event evento de submissao no form\n   * @memberof Login\n   */\n\n\n  handleSubmit(event) {\n    event.preventDefault();\n    this.login();\n  }\n  /**\n   * Utilizado para gerenciar as alteracoes nos \n   * formularios da pagina, guardando os valores no\n   * estado\n   *\n   * @param {*} event evento de mudanca no form\n   * @memberof Login\n   */\n\n\n  handleChange(event) {\n    this.setState({\n      [event.target.name]: event.target.value,\n      error: false\n    });\n  }\n  /**\n   * Armazena os dados do usuario no armazenamento\n   * local.\n   *\n   * @param {*} id id do usuario logado\n   * @param {*} type tipo do usuario logado (charity ou person)\n   * @memberof Login\n   */\n\n\n  logged(id, type) {\n    sessionStorage.setItem('id', id);\n    sessionStorage.setItem('type', type.toUpperCase());\n    window.location.reload();\n  }\n  /**\n   * Muda o estado da pagina para mostrar um erro\n   * que ocorra ao realizar login.\n   *\n   * @param {*} error mensagem de error\n   * @memberof Login\n   */\n\n\n  loginError(error) {\n    this.setState({\n      errorMessage: error,\n      error: true\n    });\n  }\n  /**\n   * Realiza a configuracao do WebSocket (conexao Client-Server)\n   * para realizar a comunicacao e receber os dados \n   *\n   * @memberof Login\n   */\n\n\n  setupSocket() {\n    this.socket = Connection;\n\n    this.socket.onmessage = r => {\n      const response = JSON.parse(r.data);\n      console.log(response);\n\n      switch (response.type) {\n        case ResponseType.SUCCESS:\n          this.logged(response.id, response.message);\n          break;\n\n        case ResponseType.FAIL:\n          this.loginError(response.message);\n          break;\n\n        default:\n          this.setState({\n            errorMessage: 'Erro: Indefinido.',\n            error: true\n          });\n      }\n    };\n  }\n  /**\n   * Metodo built-in da classe Component que é\n   * chamado sempre que o componente é montado\n   *\n   * @memberof Login\n   */\n\n\n  componentDidMount() {\n    this.setupSocket();\n  }\n  /**\n   * Metodo built-in do component react que retorna o componente JSX\n   * a ser renderizado na tela.\n   * Uma tela com campos de login e senha para realizar o login do \n   * usuario.\n   *\n   * @returns JSX Component\n   * @memberof Login\n   */\n\n\n  render() {\n    return sessionStorage.getItem('id') ? React.createElement(Redirect, {\n      to: \"/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      className: 'content login',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, \"Logar\"), this.state.error && React.createElement(\"p\", {\n      className: 'error',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, this.state.errorMessage), React.createElement(\"form\", {\n      name: \"login\",\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      onChange: this.handleChange,\n      name: \"username\",\n      type: \"text\",\n      placeholder: \"Username\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      onChange: this.handleChange,\n      name: \"password\",\n      type: \"password\",\n      placeholder: \"Senha\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Entrar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Login;","map":{"version":3,"sources":["/home/alex/Documents/usp/graduacao/terceiroSemestre/POO/Projeto/Client/charity-donation/src/pages/Login.js"],"names":["React","Component","ResponseType","Connection","CryptoJS","Redirect","Login","constructor","props","state","errorMessage","handleSubmit","bind","handleChange","login","socket","readyState","OPEN","setTimeout","username","password","hashPass","MD5","user","toString","msg","type","LOGIN","message","JSON","stringify","send","setState","error","event","target","reset","preventDefault","name","value","logged","id","sessionStorage","setItem","toUpperCase","window","location","reload","loginError","setupSocket","onmessage","r","response","parse","data","console","log","SUCCESS","FAIL","componentDidMount","render","getItem"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport ResponseType from '../connection/ResponseType'\nimport Connection from '../connection/Connection'\nimport CryptoJS from 'crypto-js'\nimport {Redirect} from 'react-router-dom'\n\n/**\n * Componente do React criado utilizando classes para\n * que possa ter acesso a estados. Possui metodos para \n * renderizar e buscar dados no servidor.\n * O componente Login representa uma pagina de login.\n *\n * @class Login\n * @extends {Component}\n */\nclass Login extends Component {\n    /**\n     * Cria uma instancia de Login, que é um JSX Component\n     * \n     * @param {*} props propriedades passadas para o objeto\n     * @memberof Login\n     */\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            errorMessage: ''\n        }\n\n        this.handleSubmit = this.handleSubmit.bind(this)\n        this.handleChange = this.handleChange.bind(this)\n    }\n\n    /**\n     * Envia um request de login para o servidor, ou muda o \n     * estado para mostrar um erro, caso user ou senha sejam \n     * invalidos\n     *\n     * @memberof Login\n     */\n    login() {\n        if (this.socket.readyState !== this.socket.OPEN) \n            setTimeout(this.login, 10)\n\n        const { username, password } = this.state\n        if (username && password) {\n            const hashPass = CryptoJS.MD5(password)\n            const user = {\n                username: username,\n                password: hashPass.toString()\n            }\n\n            const msg = {\n                type: ResponseType.LOGIN,\n                message: JSON.stringify(user)\n            }\n\n            this.socket.send(JSON.stringify(msg))\n        } else {\n            this.setState({\n                error: true,\n                errorMessage: 'Insira o nome e a senha'\n            })\n        }\n\n        event.target.reset()\n    }\n\n    /**\n     * Utilizado para gerenciar as submissoes dos \n     * formularios da pagina, realizando a chamada \n     * de login\n     *\n     * @param {*} event evento de submissao no form\n     * @memberof Login\n     */\n    handleSubmit(event) {\n        event.preventDefault()\n        this.login()\n    } \n\n    /**\n     * Utilizado para gerenciar as alteracoes nos \n     * formularios da pagina, guardando os valores no\n     * estado\n     *\n     * @param {*} event evento de mudanca no form\n     * @memberof Login\n     */\n    handleChange(event) {\n        this.setState({\n            [event.target.name]: event.target.value,\n            error: false\n        })\n    }\n\n    /**\n     * Armazena os dados do usuario no armazenamento\n     * local.\n     *\n     * @param {*} id id do usuario logado\n     * @param {*} type tipo do usuario logado (charity ou person)\n     * @memberof Login\n     */\n    logged(id, type) {\n        sessionStorage.setItem('id', id)\n        sessionStorage.setItem('type', type.toUpperCase())   \n        window.location.reload()     \n    }\n\n    /**\n     * Muda o estado da pagina para mostrar um erro\n     * que ocorra ao realizar login.\n     *\n     * @param {*} error mensagem de error\n     * @memberof Login\n     */\n    loginError(error) {\n        this.setState({\n            errorMessage: error, \n            error: true\n        })\n    }\n\n    /**\n     * Realiza a configuracao do WebSocket (conexao Client-Server)\n     * para realizar a comunicacao e receber os dados \n     *\n     * @memberof Login\n     */\n    setupSocket() {\n        this.socket = Connection\n        \n        this.socket.onmessage = (r) => {\n            const response = JSON.parse(r.data)\n            console.log(response)\n            switch (response.type) {\n                case ResponseType.SUCCESS:\n                    this.logged(response.id, response.message)\n                    break\n                case ResponseType.FAIL:\n                    this.loginError(response.message)\n                    break\n                default:\n                    this.setState({\n                        errorMessage: 'Erro: Indefinido.',\n                        error: true\n                    })\n            }\n        }        \n    }\n\n    /**\n     * Metodo built-in da classe Component que é\n     * chamado sempre que o componente é montado\n     *\n     * @memberof Login\n     */\n    componentDidMount() {\n        this.setupSocket()\n    }\n\n    /**\n     * Metodo built-in do component react que retorna o componente JSX\n     * a ser renderizado na tela.\n     * Uma tela com campos de login e senha para realizar o login do \n     * usuario.\n     *\n     * @returns JSX Component\n     * @memberof Login\n     */\n    render() {\n        return (\n            sessionStorage.getItem('id') ?\n            <Redirect to='/'></Redirect> :\n            <div className={'content login'}>\n                <h2>Logar</h2>\n                {this.state.error &&\n                <p className={'error'}>{this.state.errorMessage}</p>}\n                <form name='login' onSubmit={this.handleSubmit}>\n                    <input onChange={this.handleChange} name='username' type='text' placeholder='Username'></input>\n                    <input onChange={this.handleChange} name='password' type='password' placeholder='Senha'></input>\n                    <input type='submit' value='Entrar'></input>\n                </form>\n            </div>\n        )\n    }\n}\n\nexport default Login"]},"metadata":{},"sourceType":"module"}